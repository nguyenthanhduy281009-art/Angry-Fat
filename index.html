<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Angry Character Clone</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
    <style>
        body { margin: 0; overflow: hidden; background: #222; }
        canvas { display: block; margin: auto; background: #87CEEB; }
    </style>
</head>
<body>

<script>
const { Engine, Render, Runner, World, Bodies, Mouse, MouseConstraint, Constraint, Composite } = Matter;

// Khởi tạo Engine & Renderer
const engine = Engine.create();
const render = Render.create({
    element: document.body,
    engine: engine,
    options: {
        width: 1000,
        height: 600,
        wireframes: false,
        background: '#87CEEB'
    }
});

Render.run(render);
Runner.run(Runner.create(), engine);

// 1. Tạo mặt đất
const ground = Bodies.rectangle(500, 580, 1000, 40, { isStatic: true, render: { fillStyle: '#2e7d32' } });

// 2. Tạo nhân vật (Chim) sử dụng hình ảnh của bạn
const characterImg = 'https://drive.google.com/thumbnail?id=1SGW0oc5yuw1WmArQ9GbNSQYBPbmXRWdi&sz=w100'; // Link thumbnail để load trực tiếp
const bird = Bodies.circle(200, 450, 25, {
    density: 0.004,
    render: {
        sprite: {
            texture: characterImg,
            xScale: 0.2, // Điều chỉnh tỉ lệ hình ảnh
            yScale: 0.2
        }
    }
});

// 3. Tạo ná cao su (Sling)
const anchor = { x: 200, y: 450 };
const elastic = Constraint.create({
    pointA: anchor,
    bodyB: bird,
    stiffness: 0.1,
    length: 0.01,
    render: { strokeStyle: '#4a2c02', lineWidth: 5 }
});

// 4. Tạo mục tiêu (Các khối gỗ và lợn)
function createStack() {
    const stack = [];
    for (let i = 0; i < 3; i++) {
        for (let j = 0; j < 5; j++) {
            stack.push(Bodies.rectangle(700 + i * 40, 500 - j * 50, 30, 50, {
                render: { fillStyle: '#b5651d', strokeStyle: 'black', lineWidth: 1 }
            }));
        }
    }
    return stack;
}
const obstacles = createStack();

World.add(engine.world, [ground, bird, elastic, ...obstacles]);

// 5. Điều khiển chuột
const mouse = Mouse.create(render.canvas);
const mouseConstraint = MouseConstraint.create(engine, {
    mouse: mouse,
    constraint: { stiffness: 0.2, render: { visible: false } }
});

World.add(engine.world, mouseConstraint);

// 6. Logic bắn: Thả chuột ra thì đứt dây
let isFiring = false;
Matter.Events.on(mouseConstraint, 'enddrag', function(e) {
    if (e.body === bird) isFiring = true;
});

Matter.Events.on(engine, 'afterUpdate', function() {
    if (isFiring && bird.position.x > 210) {
        // Thay thế vật thể mới sau khi bắn hoặc giải phóng ràng buộc
        elastic.bodyB = null;
        elastic.render.visible = false;
        isFiring = false;
    }
});

</script>
</body>
</html>
